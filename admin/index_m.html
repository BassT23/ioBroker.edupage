<script>
  window.load = function (settings, onChange) {
    if (!settings) settings = {};

    // defaults
    if (settings.intervalMin === undefined) settings.intervalMin = 15;
    if (settings.maxLessons === undefined) settings.maxLessons = 12;
    if (settings.enableWeek === undefined) settings.enableWeek = false;

    document.querySelectorAll('.value').forEach(el => {
      const id = el.id;

      if (el.type === 'checkbox') {
        el.checked = !!settings[id];
      } else {
        el.value = (settings[id] ?? '');
      }

      el.addEventListener('change', () => onChange(true));
      el.addEventListener('input', () => onChange(true));
    });

    onChange(false);
  };

  window.save = function (callback) {
    const obj = {};
    document.querySelectorAll('.value').forEach(el => {
      if (el.type === 'checkbox') {
        obj[el.id] = el.checked;
      } else if (el.type === 'number') {
        obj[el.id] = el.value === '' ? 0 : parseInt(el.value, 10);
      } else {
        obj[el.id] = el.value;
      }
    });
    callback(obj);
  };
  console.log('edupage config page loaded', typeof window.load, typeof window.save);
</script>
